<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>QA Hierarchy</title>

  <!-- Self-hosted OrgChart library -->
  <script src="./orgchart.js"></script>

  <style>
    body {
      margin: 0;
      background: #F6F8FA; /* clean enterprise background */
      font-family: Arial, sans-serif;
    }

    #tree {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>

<body>
  <div id="tree"></div>

  <script>
    /* ============================
       SAFE TEMPLATE SETUP
       ============================ */

    // Pick whatever template exists in your orgchart.js
    const templateNames = Object.keys(OrgChart.templates || {});
    const baseName = templateNames.includes("olivia")
      ? "olivia"
      : templateNames[0];

    const base = OrgChart.templates[baseName];

    // Clone base template
    OrgChart.templates.qa = Object.assign({}, base);

    // Bigger cards
    OrgChart.templates.qa.size = [360, 140];

    // White card + blue header (standard enterprise)
    OrgChart.templates.qa.node =
      '<rect x="0" y="0" width="360" height="140" rx="14" ry="14" fill="#FFFFFF" stroke="#D0D7DE" stroke-width="2"></rect>' +
      '<rect x="0" y="0" width="360" height="36" rx="14" ry="14" fill="#2563EB"></rect>';

    // Name (wrap, bold)
    OrgChart.templates.qa.field_0 =
      '<text data-width="330" data-text-overflow="multiline" data-text-line="2" ' +
      'style="font-size:18px;font-weight:700;" fill="#111827" ' +
      'x="180" y="62" text-anchor="middle">{val}</text>';

    // Title (wrap)
    OrgChart.templates.qa.field_1 =
      '<text data-width="330" data-text-overflow="multiline" data-text-line="2" ' +
      'style="font-size:13px;" fill="#374151" ' +
      'x="180" y="102" text-anchor="middle">{val}</text>';

    /* ============================
       DATA SOURCE (YOUR URL)
       ============================ */

    const DATA_URL =
      "https://script.google.com/macros/s/AKfycbzEoXPpUbFVUIZiM2YiF6vONK3J_RGjmhAz-FPluMrIr1wBcqGHx84sAcYML_kGUAdd/exec";

    fetch(DATA_URL)
      .then(res => res.json())
      .then(data => {

        // Fix root + enforce string IDs
        data.forEach(n => {
          if (n.pid === "" || n.pid === null) delete n.pid;
          n.id = String(n.id);
          if (n.pid !== undefined) n.pid = String(n.pid);
        });

        /* ============================
           RENDER VERTICAL ORG CHART
           ============================ */

        new OrgChart(document.getElementById("tree"), {
          template: "qa",
          enableSearch: true,

          // âœ… Vertical hierarchy
          layout: OrgChart.tree,
          orientation: OrgChart.orientation.top,

          // Zoom + fi
