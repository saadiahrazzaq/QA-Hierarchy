<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QA Hierarchy</title>

  <!-- OrgChart (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/@balkangraph/orgchart.js@8.15.6/dist/css/orgchart.css">
  <script src="https://unpkg.com/@balkangraph/orgchart.js@8.15.6/dist/js/orgchart.js"></script>

  <style>
    body { margin:0; background:#0b2233; font-family: Arial, sans-serif; }
    #tree { width:100vw; height:100vh; }
    #status { position:fixed; top:12px; left:12px; color:#fff; z-index:9999; }
  </style>
</head>

<body>
  <div id="status">Loading…</div>
  <div id="tree"></div>

  <script>
    const DATA_URL = "https://script.google.com/macros/s/AKfycbygw8c5ss2yW5wneBny74TUhD9_aRQIEQWZ03UaPfUyyX2J2m0cj9P7ydPbs2fXW53r/exec";

    fetch(DATA_URL)
      .then(r => r.json())
      .then(data => {

        // Root node: remove pid if empty
        data.forEach(n => {
          if (n.pid === "" || n.pid === null) delete n.pid;
          // make sure id/pid are numbers
          n.id = Number(n.id);
          if (n.pid !== undefined) n.pid = Number(n.pid);
        });

        document.getElementById("status").innerText = "Rendering…";

        new OrgChart(document.getElementById("tree"), {
          template: "olivia",          // safe template
          enableSearch: true,
          mouseScrool: OrgChart.action.zoom,
          nodeBinding: {
            field_0: "name",
            field_1: "title"
          },
          nodes: data
        });

        document.getElementById("status").innerText = "Done ✅";
        setTimeout(() => document.getElementById("status").style.display = "none", 1200);
      })
      .catch(err => {
        console.error(err);
        document.getElementById("status").innerText = "Error ❌ check console";
      });
  </script>
</body>
</html>
